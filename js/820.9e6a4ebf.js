"use strict";(self["webpackChunkdebil_overlay"]=self["webpackChunkdebil_overlay"]||[]).push([[820],{4820:function(t,e,s){s.r(e),s.d(e,{default:function(){return M}});var n=s(3396),o=s(9242);const i={id:"canvas"};function a(t,e,s,a,r,c){const l=(0,n.up)("BouncingEmote");return(0,n.wg)(),(0,n.iD)("div",i,[(0,n.Wm)(o.W3,{name:c.transition_group},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.currentEmotes,(t=>((0,n.wg)(),(0,n.j4)(l,{key:t.Id,Url:t.Url,width:t.Width},null,8,["Url","width"])))),128))])),_:1},8,["name"])])}s(560);const r={id:"bouncingEmote"},c=["src"];function l(t,e,s,o,i,a){return(0,n.wg)(),(0,n.iD)("div",r,[(0,n._)("img",{src:s.Url},null,8,c)])}function h(t){return Math.floor(Math.random()*t)}const d={name:"BouncingEmote",data(){return{maxX:0,maxY:0,interval:void 0,posX:h(window.innerWidth-100),posY:h(window.innerHeight-100),speed:2,changeX:1,changeY:1,imgHeight:96,imgPos:{x:0,y:0}}},props:{Url:String,width:Number},mounted(){this.imgPos={x:this.posX,y:this.posY},this.interval=setInterval(this.update,4)},methods:{update(){let t=window.innerWidth,e=window.innerHeight;this.maxX=t,this.maxY=e,this.posX+=this.speed*this.changeX,this.posY+=this.speed*this.changeY;let s=this.posX>=t-this.width,n=this.posY>=e-this.imgHeight,o=this.posY<=0,i=this.posX<=this.width;(i||s)&&(this.changeX*=-1),(n||o)&&(this.changeY*=-1),this.imgPos={x:this.posX,y:this.posY}}},computed:{position(){return`translate(${this.imgPos.x}px, ${this.imgPos.y}px)`},x(){return`${this.posX}px`},y(){return`${this.posY}px`}}},u=()=>{(0,o.sj)((t=>({"2e36f2e5":t.x,"2e36f2e6":t.y})))},m=d.setup;d.setup=m?(t,e)=>(u(),m(t,e)):u;var f=d,g=s(89);const p=(0,g.Z)(f,[["render",l]]);var w=p;function v(t){const e={"client-nonce":null,flags:null};let s={},n=t.split(";");return n.forEach((t=>{let n=t.split("="),o=""===n[1]?null:n[1];switch(n[0]){case"badges":case"badge-info":if(o){let t={},e=o.split(",");e.forEach((e=>{let s=e.split("/");t[s[0]]=s[1]})),s[n[0]]=t}else s[n[0]]=null;break;case"emotes":if(o){let t={},e=o.split("/");e.forEach((e=>{let s=e.split(":"),n=[],o=s[1].split(",");o.forEach((t=>{let e=t.split("-");n.push({startPosition:e[0],endPosition:e[1]})})),t[s[0]]=n})),s[n[0]]=t}else s[n[0]]=null;break;case"emote-sets":{let t=o.split(",");s[n[0]]=t;break}default:Object.prototype.hasOwnProperty.call(e,n[0])||(s[n[0]]=o)}})),s}function y(t){let e=null,s=t.split(" ");switch(s[0]){case"JOIN":case"PART":case"NOTICE":case"CLEARCHAT":case"CLEARMSG":case"HOSTTARGET":case"PRIVMSG":e={command:s[0],channel:s[1]};break;case"PING":e={command:s[0]};break;case"CAP":e={command:s[0],isCapRequestEnabled:"ACK"===s[2]};break;case"GLOBALUSERSTATE":e={command:s[0]};break;case"USERSTATE":case"ROOMSTATE":e={command:s[0],channel:s[1]};break;case"RECONNECT":e={command:s[0]};break;case"421":return null;case"001":e={command:s[0],channel:s[1]};break;case"002":case"003":case"004":case"353":case"366":case"372":case"375":case"376":return null;default:return null}return e}function b(t){if(null==t)return null;{let e=t.split("!");return{nick:2==e.length?e[0]:null,host:2==e.length?e[1]:e[0]}}}function E(t,e){let s=0,n=t.slice(s+1).trim(),o=n.indexOf(" ");return-1==o?e.botCommand=n.slice(0):(e.botCommand=n.slice(0,o),e.botCommandParams=n.slice(o).trim()),e}var T={parseMessage(t){let e={tags:null,source:null,command:null,parameters:null,action:!1},s=0,n=null,o=null,i=null,a=null;if("@"===t[s]){let e=t.indexOf(" ");n=t.slice(1,e),s=e+1}if(":"===t[s]){s+=1;let e=t.indexOf(" ",s);o=t.slice(s,e),s=e+1}let r=t.indexOf(":",s);return-1==r&&(r=t.length),i=t.slice(s,r).trim(),r!=t.length&&(s=r+1,a=t.slice(s)),e.command=y(i),null==e.command?null:(null!=n&&(e.tags=v(n)),e.source=b(o),e.parameters=a,a&&"!"===a[0]&&(e.command=E(a,e.command)),e.parameters&&("ACTION"==e.parameters.split(" ")[0]&&(e.action=!0),e.parameters=e.parameters.replace("ACTION",""),e.parameters=e.parameters.replace("","")),e)}},I=T;class k{constructor(t){this.ws=null,this.IsDisconnected=!0,this.ManuallyClosed=!1,this.channel=t,this.channelID=null,this.OnUserId=null,this.OnPrivateMessage=null}connect(){this.IsDisconnected&&(this.ws=new WebSocket("wss://irc-ws.chat.twitch.tv:443"),this.ws.onmessage=t=>this.onMessage(t),this.ws.onopen=()=>this.onOpen(),this.ws.onerror=()=>this.onError(),this.ws.onclose=()=>this.onClose())}part(t){this.ws.send(`PART #${t}`)}join(t){this.ws.send(`PART #${t}`)}disconnect(){null!=this.ws&&(this.ManuallyClosed=!0,this.ws.close())}Disconnect(){this.ws.close()}async onError(){this.ManuallyClosed||(console.log("Connection error occured, disconnecting..."),this.ws.close())}async onClose(){this.ManuallyClosed||(console.log("Disconnected, attempting to reconnect..."),["t2x2","shampan0v","rj_st","redfeed_sa"].includes(this.channel)&&this.OnPrivateMessage({tags:{"badge-info":null,badges:{},color:"#FFFFFF","display-name":"System",emotes:null,"first-msg":"0",id:"4e9b10fb-7e80-46b5-9652-efc894188334",mod:"0","returning-chatter":"0","room-id":"22484632",subscriber:"0","tmi-sent-ts":"1680165804876",turbo:"0","user-id":"407046453","user-type":null},source:{nick:"System",host:"rj_st@rj_st.tmi.twitch.tv"},command:{command:"PRIVMSG",channel:"#forsen"},parameters:"[TWITCH] Disconnected",BG:"0"}),this.IsDisconnected=!0,setTimeout((()=>{this.connect()}),1e3))}async onOpen(){console.log("1232132312"),this.IsDisconnected=!1,this.ws.send("NICK justinfan1337"),this.ws.send("JOIN #"+this.channel.toLowerCase()),this.ws.send("CAP REQ :twitch.tv/tags twitch.tv/commands")}async onMessage(t){let e=t.data.split("\r\n");e.forEach((t=>{let e=I.parseMessage(t);if(e)switch(e.command.command){case"PRIVMSG":null==this.channelID&&(this.channelID=e.tags["room-id"],this.OnUserId(e.tags["room-id"])),this.OnPrivateMessage(e);break;case"PING":this.ws.send(`PONG ${e.message}`)}}))}}s(5847);var O={async get7tvEmoteSet(t){const e=await fetch(`https://7tv.io/v3/emote-sets/${t}`);if(e.ok){let t=[];const s=await e.json();if(void 0!=s.emotes){for(const n of s.emotes)t.push({Name:n.name,ID:n.id,Type:"7TV",ZeroWidth:1==n.flags});let e=s.owner.username;return[t,e]}return[void 0,void 0]}throw"failed to fetch 7tv emote set"},async wait(t){return new Promise((e=>{setTimeout(e,t)}))},async RetryOnError(t,e,s){for(let o=0;o<s;o++)try{return await t(...e)}catch(n){console.log("Attemption failed, retrying in 1s"),console.log(`Error: ${n}`),await this.wait(1e3);continue}return console.log("Failed to fetch func"),[]},async getUserID(t){const e=await fetch(`https://api.ivr.fi/v2/twitch/user?login=${t}`);if(e.ok){console.log("IVR API successful, getting user-id...");const t=await e.json();return t[0].id}throw"Unable to get user id from ivr API!"},async getGlobalBadges(){let t={};const e=await fetch("https://api.ivr.fi/v2/twitch/badges/global");if(e.ok){const s=await e.json();for(const e of s){let s=e["versions"],n={};for(const t of s)n[t["id"]]=t["image_url_2x"];t[e["set_id"]]=n}return t}if(404!=e.status)throw"not loaded";return{}},async getSubscriberBadges(t){let e={};const s=await fetch(`https://api.ivr.fi/v2/twitch/badges/channel?id=${t}`),n=await s.json();if(s.ok&&n.length>0)for(const o of n)if("subscriber"==o["set_id"]){let t=o["versions"],s={};for(const e of t)s[e["id"]]=e["image_url_2x"];return e=s,e}if(404!=s.status&&n.length>0)throw"not loaded";return{}},async get7tvBadgesPaints(){let t=[],e=[];const s=await fetch("https://api.7tv.app/v2/badges?user_identifier=twitch_id");if(s.ok){const n=await s.json();for(const e of n["badges"])t.push({Users:e.users,Url:e.urls[1][1],Type:"7TV"});for(const t of n["paints"])e.push(t);return[t,e]}if(404!=s.status)throw"not loaded";return[]},async get7tvEmotes(t){let e={};const s=await fetch(`https://7tv.io/v3/users/twitch/${t}`);if(s.ok){const t=await s.json();for(const s of t["emote_set"]["emotes"])e[s.name]={ID:s.id,Type:"7TV",ZeroWidth:1==s.flags,ratio:s.data.host.files[0].width/s.data.host.files[0].height};return[e,t["emote_set"]["id"]]}if(404!=s.status)throw"7tv not loaded";return{}},async get7tvGlobalEmotes(){let t={};const e=await fetch("https://7tv.io/v3/emote-sets/62cdd34e72a832540de95857");if(e.ok){const s=await e.json();for(const e of s["emotes"])t[e.name]={ID:e.id,Type:"7TV",ZeroWidth:1==e.flags};return t}if(404!=e.status)throw"not loaded";return{}},async getBttvEmotes(t){let e={};const s=await fetch(`https://api.betterttv.net/3/cached/users/twitch/${t}`);if(s.ok){const t=await s.json();if(t["sharedEmotes"])for(const s of t["sharedEmotes"])e[s.code]={ID:s.id,Type:"BTTV"};if(t["channelEmotes"])for(const s of t["channelEmotes"])e[s.code]={ID:s.id,Type:"BTTV"};return e}if(404!=s.status)throw"not loaded";return{}},async getBttvGlobalEmotes(){let t={};const e=await fetch("https://api.betterttv.net/3/cached/emotes/global");if(e.ok){const s=await e.json();for(const e of s)t[e.code]={ID:e.id,Type:"BTTV"};return t}if(404!=e.status)throw"not loaded";return{}},async getFfzEmotes(t){let e={};const s=await fetch(`https://api.frankerfacez.com/v1/room/${t}`);if(s.ok){const t=await s.json();for(const s of t["sets"][t["room"]["set"].toString()]["emoticons"])e[s.name]={ID:s.id,Type:"FFZ"};let n,o;return console.log(t.room.mod_urls),void 0!=t.room.mod_urls&&(n=t.room.mod_urls["2"]),console.log(t.vip_badge),void 0!=t.room.vip_badge&&(o=t.room.vip_badge["2"]),[e,n,o]}if(404!=s.status)throw"not loaded";return[]},async getFfzGlobalEmotes(){let t={};const e=await fetch("https://api.frankerfacez.com/v1/set/global");if(e.ok){const s=await e.json();for(const e of s["sets"]["3"]["emoticons"])t[e.name]={ID:e.id,Type:"FFZ"};return t}if(404!=e.status)throw"not loaded";return{}}},P=O,x={name:"OverlayView",components:{BouncingEmote:w},computed:{transition_group(){return"0"!=this.deleteAfter?"tr":"fl"}},data(){return{channelID:null,maxEmoteLife:3,channel:"shampan0v",currentEmotes:[],Emotes:[],MessagesTemp:[],lastThink:Date.now(),meanMessagesPerSecond:0}},methods:{async get7tvchannel(){let t=await P.RetryOnError(P.get7tvEmotes,[this.channelID],3);t.length>0&&(console.log("loaded seventv channel"),this.Emotes=Object.assign(this.Emotes,t[0]))},async onUserID(t){this.channelID=t,this.get7tvchannel()},async calcMeanMessages(){let t=1/((Date.now()-this.lastThink)/1e3);this.lastThink=Date.now(),this.meanMessagesPerSecond=(this.meanMessagesPerSecond+t)/2},async decide(t){this.currentEmotes.push({Url:`https://cdn.7tv.app/emote/${t.extEmotes[0].ID}/3x.webp`,Id:t.tags.id,Width:Math.floor(32*t.extEmotes[0].ratio)}),setTimeout((t=>{this.currentEmotes=this.currentEmotes.filter((e=>e.Id!=t))}),1e3*this.maxEmoteLife,t.tags.id)}},created:async function(){this.client=new k(this.channel),this.client.OnUserId=this.onUserID,this.client.OnPrivateMessage=async t=>{this.MessagesTemp.push(t),t.extEmotes=[];for(const e of t.parameters.split(" "))if(this.Emotes[e]){let s=this.Emotes[e];t.extEmotes.push(s)}t.extEmotes.length>0&&(this.MessagesTemp.push(t),this.calcMeanMessages(),this.decide(t))},this.client.connect()}};const D=(0,g.Z)(x,[["render",a]]);var M=D},2148:function(t,e,s){var n=s(8702),o=s(2560);t.exports=function(t,e,s){return s.get&&n(s.get,e,{getter:!0}),s.set&&n(s.set,e,{setter:!0}),o.f(t,e,s)}},9633:function(t,e,s){var n=s(5027);t.exports=function(){var t=n(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e}},5847:function(t,e,s){var n=s(9037),o=s(7697),i=s(2148),a=s(9633),r=s(3689),c=n.RegExp,l=c.prototype,h=o&&r((function(){var t=!0;try{c(".","d")}catch(h){t=!1}var e={},s="",n=t?"dgimsy":"gimsy",o=function(t,n){Object.defineProperty(e,t,{get:function(){return s+=n,!0}})},i={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in t&&(i.hasIndices="d"),i)o(a,i[a]);var r=Object.getOwnPropertyDescriptor(l,"flags").get.call(e);return r!==n||s!==n}));h&&i(l,"flags",{configurable:!0,get:a})}}]);
//# sourceMappingURL=820.9e6a4ebf.js.map